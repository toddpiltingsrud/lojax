var lojax=lojax||{};(function(n,t){var u,i,r;t.on=function(t,i){n(document).on(t,function(){r.executeRequest(i)})};t.off=function(t){n(document).off(t)};t.exec=function(n){r.executeRequest(n)};t.onLoad=function(n){r.onLoad=n};t.onUnload=function(n){r.onUnload=n};t.closeModal=function(){i.hasValue(r.modal)&&(n.fn.modal?r.modal.modal("hide"):n.fn.kendoWindow&&r.modal.data("kendoWindow").close())};t.bind=function(t,r){var u=n(t);return i.hasValue(r)&&r!==""?i.setElementsFromModel(u,r):r=i.buildModelFromElements(u),u.data("model",r),r};t.emptyHashAction=null;t.events={beforeRequest:"beforeRequest",afterRequest:"afterRequest",beforeUpdateModel:"beforeUpdateModel",afterUpdateModel:"afterUpdateModel",beforeInject:"beforeInject",afterInject:"afterInject",ajaxError:"ajaxError"};t.logging=!1;t.log=function(n){try{if(t.logging&&console&&console.log)return console.log(n),console}catch(i){}return{log:function(){}}};t.error=console&&console.error?console.error:function(){};t.config={prefix:"jx-",transition:"fade-in",navHistory:!0};t.select={methodOrRequest:"[data-request],[jx-request],[data-method]:not([data-trigger]),[jx-method]:not([jx-trigger])",methodWithChange:"[data-method][data-trigger*=change],[jx-method][jx-trigger*=change]",methodWithEnterOrModel:"[data-method][data-trigger*=enter],[jx-method][jx-trigger*=enter],[data-model],[jx-model]",formWithMethod:"form[data-method],form[jx-method]",model:"[data-model],[jx-model]",panel:function(n){return"["+t.config.prefix+'panel="'+n+'"],[data-panel="'+n+'"]'},src:"[data-src],[jx-src]",preload:"[data-preload],[jx-preload]",jxModelAttribute:"[jx-model]",jxModel:"jx-model",inputTriggerChangeOrEnter:":input[name][jx-trigger*=change],:input[name][data-trigger*=change],:input[name][jx-trigger*=enter],:input[name][data-trigger*=enter]"};t.Controller=function(){var t=this;this.div=null;this.modal=null;this.currentTransition=null;this.currentPanel=null;this.cache={};this.isControl=!1;n(function(){t.div=n("<div style='display:none'><\/div>").appendTo("body");t.removeHandlers();t.addHandlers();t.loadSrc();t.bindToModels();t.preloadAsync();i.hasHash()&&setTimeout(t.handleHash)})};t.Controller.prototype={addHandlers:function(){n(document).on("click",t.select.methodOrRequest,this.handleRequest).on("change",t.select.methodWithChange,this.handleRequest).on("keydown",t.select.methodWithEnterOrModel,this.handleEnterKey).on("submit",t.select.formWithMethod,this.handleRequest).on("change",t.select.model,this.updateModel).on("keydown",this.handleControlKey).on("keyup",this.handleControlKey);t.config.navHistory&&window.addEventListener("hashchange",this.handleHash,!1)},removeHandlers:function(){n(document).off("click",this.handleRequest).off("change",this.handleRequest).off("keydown",this.handleEnterKey).off("submit",this.handleRequest).off("change",this.updateModel).off("keydown",this.handleControlKey).off("keyup",this.handleControlKey);t.config.navHistory&&window.removeEventListener("hashchange",this.handleHash,!1)},handleRequest:function(u){var e;u.stopPropagation();var o=i.getConfig(this),h=n(this),f=new t.Request(o);try{if(f.isNavHistory){if(r.isControl)return;r.currentTransition=f.transition;e=f.action;f.data&&(e+="?"+f.data);"#"+e===window.location.hash?r.handleHash():window.location.hash=e}else r.executeRequest(f)}catch(s){t.error(s)}u.preventDefault()},handleEnterKey:function(n){n.which===13&&r.handleRequest.call(this,n)},handleControlKey:function(n){n.which===17&&(r.isControl=n.type==="keydown")},handleHash:function(){if(t.config.navHistory){var f,u=window.location.hash;i.hasHash()?(f=n('a[name="'+u.substr(1)+'"]'),f.length===0&&r.executeRequest({action:u,method:"ajax-get",transition:r.currentTransition}),r.currentTransition=null):u===""&&t.emptyHashAction&&r.executeRequest(t.emptyHashAction)}},executeRequest:function(n){(n instanceof t.Request||(n=new t.Request(n)),n.action!==null)&&(n.action in this.cache?(n=this.cache[n.action],delete this.cache[n.action]):n.exec(),n.then(function(t){r.injectContent(n,t)}).catch(r.handleError))},bindToModels:function(r){r=r||document;var u,f=n(r).find(t.select.model).add(r).filter(t.select.model);f.each(function(){u=n(this);model=i.getModel(u);model=t.bind(u,model)})},updateModel:function(r){var f=r.target.name;if(i.hasValue(f)&&f!=""){var u=n(this),o=n(r.target),s=i.getModel(u),h=u.find('[name="'+f+'"]'),e={target:r.target,name:f,value:o.val(),model:s,cancel:!1};(i.triggerEvent(t.events.beforeUpdateModel,e,u),e.cancel)||(i.setModelProperty(u,e.model,h),i.triggerEvent(t.events.afterUpdateModel,e,u),i.propagateChange(s,o))}},injectContent:function(u,f){var v,c,a,y,e,o,l,s,h;if(i.hasValue(f)&&(r.onLoad=null,l=function(){var f=n(this);v=i.attr(f,"panel");c=u.target||n(t.select.panel(v)).first();c.length&&(y=i.resolveTransition(u,f),i.callOnUnload(c),o=y(c,f),i.hasValue(u)&&(o.refresh=u.exec.bind(u)),i.triggerEvent(t.events.afterInject,o,f),r.bindToModels(o),typeof r.onUnload=="function"&&(n(o)[0].onUnload=r.onUnload,r.onUnload=null),i.callOnLoad(o,u),r.loadSrc(o),r.preloadAsync(o))},s=n.parseHTML(f,!0),s)){if(u.target)l.call(n(f));else for(h=0;h<s.length;h++){if(e=n(s[h]),i.triggerEvent(t.events.beforeInject,s,e),r.modal===null)if(e.is(".modal")){r.createModal(e,u);continue}else a=e.find(".modal"),a.length&&r.createModal(a,u);u.target||e.is(i.attrSelector("panel"))?l.call(e):n(s[h]).find(i.attrSelector("panel")).each(l)}r.div.empty();s.forEach(function(t){e=n(t);e.is("script,style")&&r.div.append(e)})}},createModal:function(t,u){if(n.fn.modal){r.modal=n(t).appendTo("body").modal({show:!1,keyboard:!0});r.modal.on("hidden.bs.modal",function(){i.hasValue(r.modal)&&(r.modal.off("hidden.bs.modal",r.onModalClose),r.modal.modal("hide"),n(r.modal).remove(),r.modal=null)});r.modal.modal("show")}else n.fn.kendoWindow&&(r.modal=n(t).appendTo("body").kendoWindow({title:n(t).find(".dialog-header").text(),modal:!0,animation:{open:{effects:"fade:in"}},visible:!1,close:function(){i.hasValue(r.modal)&&(r.modal.data("kendoWindow").destroy(),n(r.modal).remove(),r.modal=null)}}),r.modal.data("kendoWindow").center().open(),r.modal.find("[data-dismiss=modal]").click(function(){r.modal.data("kendoWindow").close()}));r.modal&&(r.bindToModels(r.modal),i.callOnLoad(r.modal,u),r.loadSrc(r.modal),r.preloadAsync(r.modal))},loadSrc:function(u){u=u||document;n(u).find(t.select.src).each(function(){var u=n(this),f=i.attr(u,"src"),t=i.getConfig(u);t.action=i.noCache(t.src);t.method=t.method||"ajax-get";t.target=u;t.transition=t.transition||"swap-content";t.suppressEvents=!0;r.executeRequest(t)})},preloadAsync:function(r){var e=this,f,u;r=r||document;setTimeout(function(){n(r).find(t.select.preload).each(function(){f=i.getConfig(this);f.suppressEvents=!0;u=new t.Request(f);i.hasValue(u.action)&&!e.cache[u.action]&&(e.cache[u.action]=u,u.exec())})})},handleError:function(n){if(i.triggerEvent(t.events.ajaxError,n),!n.handled){var r=[];Object.getOwnPropertyNames(n).forEach(function(t){typeof n[t]!="function"&&r.push(n[t])})}}};u={segments:/[^\[\]\.\s]+|\[\d+\]/g,indexer:/\[\d+\]/,search:/\?.+(?=#)|\?.+$/,hash:/#((.*)?[a-z]{2}(.*)?)/i,json:/^\{.*\}$|^\[.*\]$/};i={noop:function(){},hasValue:function(n){return n!==undefined&&n!==null},attr:function(i,r){return n(i).attr("data-"+r)||n(i).attr(t.config.prefix+r)},attrSelector:function(n){return"[data-"+n+"],["+t.config.prefix+n+"]"},isJSON:function(n){return u.json.test(n)},attributes:"method action transition target form model preload src".split(" "),getConfig:function(t){var r,u=n(t);return u.is(i.attrSelector("request"))?r=JSON.parse(i.attr(u,"request").replace(/'/g,'"')):(r={},i.attributes.forEach(function(n){var t=i.attr(u,n);t!==undefined&&(r[n]=t)})),r.source=t,r},resolveAction:function(t){var r,u;return i.hasValue(t.action)&&t.action.length?r=t.action:i.hasValue(t.source)&&i.hasValue(t.source.href)&&t.source.href.length&&t.source.href.substr(0,11)!=="javascript:"?r=t.source.href:n(t.source).is("[type=submit]")?(u=n(t.source).closest("form,"+i.attrSelector("model")),u.is("form")&&(r=u.attr("action")||window.location.href)):n(t.source).is("form")&&(r=n(t.source).attr("action")||window.location.href),t.method==="ajax-get"&&i.hasHash(r)&&(r=i.resolveHash(r),t.isNavHistory=!0),r},resolveHash:function(n){return(n=n||window.location.href,i.hasHash(n))?n.substr(n.indexOf("#")+1):n},resolveForm:function(r){var u;return i.hasValue(r.form)?n(r.form).find(":input").add(n(r.form).filter(":input")):n(r.source).is("[type=submit]")&&(u=n(r.source).closest("form,"+t.select.model),u.is("form"))?u:n(r.source).is("form")||n(r.source).is(t.select.inputTriggerChangeOrEnter)?r.source:null},resolveModel:function(r){var f,u;return i.hasValue(r.model)?u=r.model:i.hasValue(r.source)&&n(r.source).is(t.select.model)?u=i.getModel(r.source):n(r.source).is("input[type=submit],button[type=submit]")&&(f=n(r.source).closest("form,"+t.select.model),f.is(t.select.model)&&(u=i.getModel(f))),typeof u=="string"&&u.length&&(u=i.isJSON(u)?JSON.parse(u):new t.Request({action:u,method:"ajax-get"})),r.source&&u&&n(r.source).data("model",u),u},getModel:function(r){var f=n(r),u=f.data("model");if(!i.hasValue(u)&&n(r).is(t.select.jxModelAttribute)){if(u=f.attr(t.select.jxModel),!u)return null;u=i.isJSON(u)?JSON.parse(u):new t.Request({action:u,method:"ajax-get"});f.data("model",u)}return u},resolveTarget:function(t){return i.hasValue(t.target)?n(t.target):null},resolveTransition:function(n,r){return n.transition?t.Transitions[n.transition]||t.Transitions[t.config.transition]:t.Transitions[i.attr(r,"transition")]||t.Transitions[t.config.transition]},formFromInputs:function(t,i,r){if(n(t).length){i=i||window.location.href;r=r||"POST";var u=n("<form method='"+r.toUpperCase()+"' action='"+i+"' style='display:none'><\/form>"),f=n(t).serializeArray();return f.forEach(function(t){n("<input type='hidden' />").appendTo(u).prop("name",t.name).val(t.value)}),u}return t},formFromModel:function(t,r,u,f,e){var o,s,h;i.hasValue(e)||(r=r||"POST",u=u||window.location.href,e=n("<form method='"+r.toUpperCase()+"' action='"+u+"' style='display:none'><\/form>"),f="");o=n.type(t);switch(o){case"null":case"undefined":n("<input type='hidden' />").appendTo(e).prop("name",f);break;case"date":n("<input type='hidden' />").appendTo(e).prop("name",f).val(t.toISOString());break;case"array":t.forEach(function(n){i.formFromModel(n,r,u,f,e)});break;case"object":s=Object.getOwnPropertyNames(t);s.forEach(function(n){h=f===""?n:f+"."+n;i.formFromModel(t[n],r,u,h,e)});break;default:n("<input type='hidden' />").appendTo(e).prop("name",f).val(t.toString())}return e},getPathSegments:function(n){return n.match(u.segments)},resolvePathSegment:function(n){return u.indexer.test(n)?parseInt(/\d+/.exec(n)):n},getObjectAtPath:function(n,t,r){for(var e=n,s,o=Array.isArray(t)?t:i.getPathSegments(t),f=0;f<o.length;f++){if(s=i.resolvePathSegment(o[f]),e[s]===undefined&&(e[s]=f<o.length-1&&u.indexer.test(o[f+1])?[]:f===o.length-1&&r?[]:f<o.length-1?{}:null),f===o.length-1&&(u.indexer.test(s)||Array.isArray(e[s])===!1))return e;e=e[s]}return e},setModelProperty:function(t,r,u){var f,o,h,e,s;s=i.getPathSegments(u[0].name);e=i.getValue(u);f=i.getObjectAtPath(r,s,Array.isArray(e));o=i.resolvePathSegment(s[s.length-1]);o in f?h=n.type(f[o]):Array.isArray(f)&&f.length&&(h=n.type(f[0]));e=i.castValues(e,h);Array.isArray(e)&&Array.isArray(f)?(f.splice(0,f.length),e.forEach(function(n){f.push(n)})):f[o]=e},buildModelFromElements:function(t){var u={},r={},f=n(t).find("[name]");return f.each(function(){this.name in r||(r[this.name]=n(t).find('[name="'+this.name+'"]'))}),Object.getOwnPropertyNames(r).forEach(function(n){i.setModelProperty(t,u,r[n])}),u},setElementsFromModel:function(t,r){var u,f,e,o=n(t);o.find("[name]").each(function(){e=this.name||n(this).attr("name");u=i.getModelValue(r,e);f=n.type(u);f==="date"&&this.type==="date"?n(this).val(i.standardDateFormat(u)):f==="boolean"&&this.type==="checkbox"?this.checked=u:this.type==="radio"?this.checked=this.value==u:this.value!==undefined?n(this).val(u):this.innerHTML!==undefined&&n(this).html(u==null?"":u.toString())})},getModelValue:function(n,t){var r,u=i.getPathSegments(t),f=i.resolvePathSegment(u[u.length-1]);try{return(r=i.getObjectAtPath(n,u),r[f]!==undefined)?r[f]:r}catch(e){console&&console.error&&(console.error("Could not resolve object path: "+t),console.error(e))}},triggerEvent:function(t,i,r){try{n.event.trigger({type:t,source:r||i},i)}catch(u){console&&console.error&&console.error(u)}},beforeRequest:function(n,r){r||i.triggerEvent(t.events.beforeRequest,n)},afterRequest:function(n,r){r||i.triggerEvent(t.events.afterRequest,n)},hasHash:function(n){return n=n||window.location.href,u.hash.test(n)},standardDateFormat:function(n){if(!i.hasValue(n)||n=="")return n;if(typeof n=="string")return n.substring(0,10);var f=n.getFullYear(),r=n.getMonth()+1,u=n.getDate(),t=[];return t.push(f),t.push("-"),r<10&&t.push("0"),t.push(r),t.push("-"),u<10&&t.push("0"),t.push(u),t.join("")},callOnLoad:function(n,t){n&&r.onLoad&&r.onLoad.call(n,t);r.onLoad=null},callOnUnload:function(n){n&&typeof n[0].onUnload=="function"&&(n[0].onUnload.call(n),n[0].onUnload=null)},nonce:jQuery.now(),noCache:function(n){var r=(n.indexOf("?")!=-1?"&_=":"?_=")+i.nonce++,t=n.match(/\?.+(?=#)|\?.+$|.+(?=#)|.+/);return n.replace(t,t+r)},getValue:function(n){if(n.length===0)return null;var t,i=n[0].type,r=n.length>1&&i!=="radio"&&n.filter('[type="'+i+'"]').length===n.length;return(i==="checkbox"?r?t=n.serializeArray().map(function(n){return n.value}):(t=n.val(),t=t.toLowerCase()=="true"?n[0].checked.toString():t.toLowerCase()=="false"?(!n[0].checked).toString():n[0].checked?t:null):t=r?n.serializeArray().map(function(n){return n.value}):n.val(),!r&&t==="")?null:t},castValues:function(t,i){var u=Array.isArray(t),r=u?t:[t];switch(i){case"number":r=r.filter(n.isNumeric).map(parseFloat);break;case"boolean":r=r.map(function(n){return n.toLowerCase()=="true"});break;case"null":case"undefined":r=r.map(function(n){return/true|false/i.test(n)?n.toLowerCase()==="true":n===""?null:n});break;default:r=r.map(function(n){return n===""?null:n})}return u?r:r[0]},propagateChange:function(r,u){var f=n(u);n(document).find('[name="'+f[0].name+'"]').not(f).each(function(){var u=n(this).closest(t.select.model),f;u.length&&(f=i.getModel(u),f===r&&t.bind(u,f))})}};t.priv=i;t.Request=function(n){typeof n=="function"&&(n=n());typeof n=="string"&&(n={action:n,method:"ajax-get"});this.method=n.method.toLowerCase();this.form=i.resolveForm(n);this.action=i.resolveAction(n);this.isNavHistory=n.isNavHistory;this.model=i.resolveModel(n);this.contentType="application/x-www-form-urlencoded; charset=UTF-8";this.transition=n.transition;this.target=i.resolveTarget(n);this.data=this.getData(n);this.source=n.source;this.preload="preload"in n;this.cancel=!1;this.resolve=null;this.reject=null;this.result=null;this.error=null;this.suppressEvents=n.suppressEvents||!1};t.Request.prototype={getData:function(){var t;switch(this.method){case"get":case"ajax-get":case"ajax-delete":case"jsonp":this.model?t=i.formFromModel(this.model).serialize():this.form&&(t=i.formFromInputs(this.form,this.action,this.method).serialize());break;case"post":t=this.model?i.formFromModel(this.model):this.form?i.formFromInputs(this.form,this.action,this.method):n("<form method='POST' action='"+this.action+"' style='display:none'><\/form>");break;case"ajax-post":case"ajax-put":this.model?(t=JSON.stringify(this.model),this.contentType="application/json"):this.form&&(t=i.formFromInputs(this.form,this.action,this.method).serialize())}return t},getFullUrl:function(){switch(this.method){case"get":case"ajax-get":case"ajax-delete":case"jsonp":return this.action+(this.data?"?"+this.data:"");default:return this.action}},ajax:function(t){var i=this;n.ajax({url:this.action,type:t.toUpperCase(),data:this.data,contentType:this.contentType}).done(i.done.bind(i)).fail(i.fail.bind(i))},done:function(n){this.result=n;this.resolve&&this.resolve(n);i.afterRequest(this,this.suppressEvents)},fail:function(n){this.error=n;this.reject&&this.reject(n);i.afterRequest(this,this.suppressEvents)},methods:{get:function(){window.location=this.getFullUrl();i.afterRequest(this,this.suppressEvents)},post:function(){var t=this,n=this.data;n.appendTo("body");n[0].submit();setTimeout(function(){n.remove();i.afterRequest(t,t.suppressEvents)},0)},"ajax-get":function(){n.get(this.action,this.data).done(this.done.bind(this)).fail(this.fail.bind(this))},"ajax-post":function(){this.ajax("post")},"ajax-put":function(){this.ajax("put")},"ajax-delete":function(){this.ajax("delete")},jsonp:function(){var t=this,n=document.createElement("script");n.type="text/javascript";n.src=this.getFullUrl();document.body.appendChild(n);setTimeout(function(){document.body.removeChild(n);i.afterRequest(t,t.suppressEvents)},10)}},exec:function(){if(this.reset(),!i.hasValue(this.methods[this.method]))throw"Unsupported method: "+this.method;return i.hasValue(this.action)&&this.action!==""&&(i.beforeRequest(this,this.suppressEvents),this.cancel?i.afterRequest(this,this.suppressEvents):this.methods[this.method].bind(this)()),this},then:function(n,t){var i=this;return typeof n=="function"&&(this.resolve=n,this.result!==null&&n(i.result)),typeof t=="function"&&(this.reject=t,this.error!==null&&t(i.error)),this},"catch":function(n){return this.then(undefined,n)},reset:function(){this.cache||(this.result=null,this.error=null);this.cancel=!1;this.resolve=null;this.reject=null}};t.Transitions={"swap-content":function(t,i){var r=n(t),u=n(i);return r.empty().append(u.contents()),r},"fade-in":function(t,i){var r=n(t),u=n(i);return r.fadeOut(0).empty().append(u.contents()).fadeIn(),r},replace:function(t,i){var u=n(t),r=n(i);return u.replaceWith(r),r},append:function(t,i){var u=n(t),r=n(i);return u.append(r),r},prepend:function(t,i){var u=n(t),r=n(i);return u.prepend(r),r}};t.instance=new t.Controller;r=t.instance})(jQuery,lojax);
//# sourceMappingURL=lojax.min.js.map
